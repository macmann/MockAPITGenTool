<h2>MCP Servers</h2>
<p class="muted">Configure MCP servers that expose selected mock endpoints as tools.</p>

<% if (statusMessage) { %>
  <div class="flash <%= statusType ? `flash-${statusType}` : '' %>"><%= statusMessage %></div>
<% } %>

<p>
  <a class="button" href="/admin/mcp/new?key=<%= encodeURIComponent(query?.key || '') %>">+ New MCP Server</a>
  <a class="button secondary" href="/admin?key=<%= encodeURIComponent(query?.key || '') %>">Back to endpoints</a>
</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Base URL</th>
      <th>Status</th>
      <th>Enabled</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% for (const s of servers || []) { %>
      <tr>
        <td><strong><%= s.name %></strong><br/><span class="muted"><%= s.description || '' %></span></td>
        <td><code><%= s.base_url || '' %></code></td>
        <td>
          <% const status = statuses && statuses[s.id] ? statuses[s.id] : { state: 'disabled' }; %>
          <% if (status.state === 'enabled') { %>
            <strong>Enabled</strong><br/><span class="muted">Mounted at /mcp</span>
          <% } else { %>
            <strong>Disabled</strong>
          <% } %>
        </td>
        <td><%= s.is_enabled ? 'Yes' : 'No' %></td>
        <td class="right">
          <div class="action-buttons">
            <a class="button button-outline" href="/admin/mcp/<%= s.id %>/info?key=<%= encodeURIComponent(query?.key || '') %>">Info</a>
            <a class="button button-outline" href="/admin/mcp/<%= s.id %>?key=<%= encodeURIComponent(query?.key || '') %>">Edit</a>
            <a class="button button-outline" href="/admin/mcp/<%= s.id %>/tools?key=<%= encodeURIComponent(query?.key || '') %>">Tools</a>
            <% if (s.is_enabled) { %>
              <form method="post" action="/admin/mcp/<%= s.id %>/stop?key=<%= encodeURIComponent(query?.key || '') %>">
                <button class="button button-outline contrast" type="submit">Disable</button>
              </form>
            <% } else { %>
              <form method="post" action="/admin/mcp/<%= s.id %>/start?key=<%= encodeURIComponent(query?.key || '') %>">
                <button class="button button-outline" type="submit">Enable</button>
              </form>
            <% } %>
          </div>
        </td>
      </tr>
    <% } %>
  </tbody>
</table>
