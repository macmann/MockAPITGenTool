<section class="page-hero">
  <div class="page-hero__content">
    <h2>MCP tools for <%= s.name %></h2>
    <p>Each tool maps to one existing mock endpoint and exposes it to MCP clients.</p>
  </div>
  <div class="page-hero__actions">
    <a class="secondary" href="/admin/mcp?key=<%= encodeURIComponent(query?.key || '') %>">Back to servers</a>
    <a class="button" href="/admin/mcp/<%= s.id %>/info?key=<%= encodeURIComponent(query?.key || '') %>">Connection info</a>
  </div>
</section>

<section class="surface-card surface-card--stacked">
  <header class="section-heading">
    <div>
      <h3>Existing tools</h3>
      <p class="muted" style="margin: 0;">Delete any tool to remove it from the MCP manifest.</p>
    </div>
  </header>
  <% if (!tools || tools.length === 0) { %>
    <p class="muted" style="margin: 0;">No tools yet. Create one below to expose a mock endpoint.</p>
  <% } else { %>
    <div class="table-card">
      <table>
        <thead>
          <tr>
            <th>Tool name</th>
            <th>Endpoint</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% for (const t of tools || []) { %>
            <tr>
              <td><code><%= t.name %></code></td>
              <td><code><%= t.method %> <%= t.path %></code></td>
              <td><%= t.description || '' %></td>
              <td>
                <div class="table-actions">
                  <form method="post" action="/admin/mcp/<%= s.id %>/tools/<%= t.id %>/delete?key=<%= encodeURIComponent(query?.key || '') %>" onsubmit="return confirm('Delete this tool?');">
                    <button class="button contrast" type="submit">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  <% } %>
</section>

<section class="surface-card surface-card--stacked">
  <header class="section-heading">
    <div>
      <h3>Add or update tool</h3>
      <p class="muted" style="margin: 0;">Choose an endpoint and optionally describe the expected arguments.</p>
    </div>
  </header>
  <form method="post" action="/admin/mcp/<%= s.id %>/tools/save?key=<%= encodeURIComponent(query?.key || '') %>" class="form-stack">
    <input type="hidden" name="id" value=""/>

    <div class="form-grid form-grid--two">
      <label class="stack">
        <span>Tool name</span>
        <input name="name" placeholder="getUserDetails" required/>
      </label>

      <label class="stack">
        <span>Description</span>
        <input name="description" placeholder="Fetch user details from mock API"/>
      </label>
    </div>

    <div class="stack">
      <span>Endpoint</span>
      <% if (!endpoints || endpoints.length === 0) { %>
        <p class="muted" style="margin: 0;">
          No endpoints are available yet. <a href="/admin/new?key=<%= encodeURIComponent(query?.key || '') %>">Create one first</a> to expose it as a tool.
        </p>
      <% } else { %>
        <div class="stack" data-single-checkbox-container>
          <div
            class="checkbox-grid"
            data-single-checkbox-group
            data-required-message="Select an endpoint to expose as a tool."
          >
            <% for (let idx = 0; idx < endpoints.length; idx++) { const e = endpoints[idx]; const checkboxId = `endpoint-option-${idx}`; %>
              <label class="checkbox checkbox-card" for="<%= checkboxId %>">
                <input
                  type="checkbox"
                  id="<%= checkboxId %>"
                  name="endpoint_id"
                  value="<%= e.id %>"
                  data-single-checkbox
                />
                <div class="checkbox-card__body">
                  <div class="checkbox-card__title">
                    <code><%= e.method %></code>
                    <span>â†’</span>
                    <code><%= e.path %></code>
                  </div>
                  <% if (e.description) { %>
                    <p class="muted" style="margin: 0;"><%= e.description %></p>
                  <% } %>
                </div>
              </label>
            <% } %>
          </div>
          <p class="form-error" data-checkbox-error hidden>Select an endpoint to expose as a tool.</p>
        </div>
        <small class="muted">Choose exactly one endpoint to connect to this MCP tool.</small>
      <% } %>
    </div>

    <label class="stack">
      <span>Arg schema (JSON)</span>
      <textarea name="arg_schema" rows="6" placeholder='{
  "type": "object",
  "properties": {
    "userid": { "type": "string", "description": "User ID" }
  },
  "required": ["userid"]
}'></textarea>
      <small class="muted">Optional: describe the arguments your tool expects.</small>
    </label>

    <button class="button primary" type="submit" style="justify-self: flex-start;">Save tool</button>
  </form>
</section>
