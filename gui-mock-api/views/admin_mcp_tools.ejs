<% layout('layout', { base: '' }) %>
<h2>MCP Tools for <%= s.name %></h2>
<p class="muted">Each tool maps to one existing mock endpoint and exposes it to MCP clients.</p>

<p>
  <a class="button secondary" href="/admin/mcp?key=<%= encodeURIComponent(query.key||'') %>">‚Üê Back to MCP servers</a>
</p>

<h3>Existing Tools</h3>
<table>
  <thead>
    <tr>
      <th>Tool Name</th>
      <th>Endpoint</th>
      <th>Description</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% for (const t of tools) { %>
      <tr>
        <td><code><%= t.name %></code></td>
        <td><code><%= t.method %> <%= t.path %></code></td>
        <td><%= t.description || '' %></td>
        <td class="right">
          <form method="post" action="/admin/mcp/<%= s.id %>/tools/<%= t.id %>/delete?key=<%= encodeURIComponent(query.key||'') %>" onsubmit="return confirm('Delete this tool?');">
            <button class="button button-outline" type="submit">Delete</button>
          </form>
        </td>
      </tr>
    <% } %>
  </tbody>
</table>

<h3 style="margin-top:1.5rem;">Add / Update Tool</h3>
<form method="post" action="/admin/mcp/<%= s.id %>/tools/save?key=<%= encodeURIComponent(query.key||'') %>" class="grid" style="gap:1rem;">
  <input type="hidden" name="id" value=""/>

  <label>
    Tool Name
    <input name="name" placeholder="getUserDetails" required/>
  </label>

  <label>
    Description
    <input name="description" placeholder="Fetch user details from mock API"/>
  </label>

  <label>
    Endpoint
    <select name="endpoint_id" required>
      <option value="">-- Select endpoint --</option>
      <% for (const e of endpoints) { %>
        <option value="<%= e.id %>"><%= e.method %> <%= e.path %></option>
      <% } %>
    </select>
  </label>

  <label>
    Arg Schema (JSON)
    <textarea name="arg_schema" rows="6" placeholder='{
  "type": "object",
  "properties": {
    "userid": { "type": "string", "description": "User ID" }
  },
  "required": ["userid"]
}'></textarea>
  </label>

  <button class="button primary" type="submit">Save Tool</button>
</form>
